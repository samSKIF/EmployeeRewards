
> rest-express@1.0.0 dev
> tsx server/index.ts

Initializing Firebase app with project ID: employee-reward-fb8ea
Using uploads directory: /home/runner/workspace/server/uploads
Initializing MongoDB for social features...
Initializing MongoDB for social features...
Connected to MongoDB successfully
MongoDB indexes created successfully
MongoDB connected successfully
MongoDB social routes initialized
ðŸŽ‚ Scheduling birthday rewards job (daily at 08:00)
10:51:52 AM [express] serving on port 5000
Browserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
10:52:09 AM [express] GET /api/points/balance 304 in 387ms :: {"balance":0,"userId":11}
10:52:09 AM [express] GET /api/users/departments 304 in 391ms :: ["Engineering","Finance","HR","Inforâ€¦
10:52:09 AM [express] GET /api/users/locations 304 in 398ms :: ["London","New York","New york office"â€¦
Birthday users found: 5
Anniversary users found: 1
Total celebrations returning: 6
10:52:09 AM [express] GET /api/celebrations/today 304 in 458ms :: [{"id":2167,"user":{"id":2167,"nameâ€¦
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
/api/users/me: Returning data for user 11 (Canva Administrator, admin@canva.com)
User isAdmin value: true
Returning 801 users for company 1
10:52:15 AM [express] GET /api/users 304 in 6917ms :: [{"id":16,"username":"brian_lopez","name":"Briaâ€¦
Final user object isAdmin: true
10:52:15 AM [express] GET /api/users/me 304 in 6291ms :: {"id":11,"username":"admin_canva","name":"Caâ€¦
10:52:16 AM [express] GET /api/celebrations/upcoming 304 in 7253ms :: [{"id":2122,"user":{"id":2122,"â€¦
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
Custom token decode - important fields:
- sub (Firebase UID): undefined
- email: admin@canva.com
- aud (audience): undefined
- iss (issuer): undefined
Failed to verify Firebase token, trying JWT: Firebase ID token has no "kid" claim. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
10:52:16 AM [express] GET /api/social/posts 304 in 291ms :: []
10:52:17 AM [express] GET /api/social/stats 304 in 1453ms :: {"posts":0,"comments":0,"reactions":0,"râ€¦
Custom token decode failed: TypeError [ERR_INVALID_ARG_TYPE]: The first argument must be of type string or an instance of Buffer, ArrayBuffer, or Array or an Array-like Object. Received undefined
    at Function.from (node:buffer:320:9)
    at verifyToken (/home/runner/workspace/server/middleware/auth.ts:61:50)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/runner/workspace/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/home/runner/workspace/node_modules/express/lib/router/index.js:175:3)
    at router (/home/runner/workspace/node_modules/express/lib/router/index.js:47:12)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at <anonymous> (/home/runner/workspace/server/index.ts:56:3)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at urlencodedParser (/home/runner/workspace/node_modules/body-parser/lib/types/urlencoded.js:103:7)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at jsonParser (/home/runner/workspace/node_modules/body-parser/lib/types/json.js:122:7)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at expressInit (/home/runner/workspace/node_modules/express/lib/middleware/init.js:40:5)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at query (/home/runner/workspace/node_modules/express/lib/middleware/query.js:45:5)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/home/runner/workspace/node_modules/express/lib/router/index.js:175:3)
    at Function.handle (/home/runner/workspace/node_modules/express/lib/application.js:181:10)
    at Server.app (/home/runner/workspace/node_modules/express/lib/express.js:39:9)
    at Server.emit (node:events:518:28) {
  code: 'ERR_INVALID_ARG_TYPE'
}
Failed to verify Firebase token, trying JWT: Decoding Firebase ID token failed. Make sure you passed the entire string JWT which represents an ID token. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
JWT verification also failed: jwt malformed
10:52:30 AM [express] POST /api/social/posts 401 in 7ms :: {"message":"Unauthorized: Invalid token"}
^A